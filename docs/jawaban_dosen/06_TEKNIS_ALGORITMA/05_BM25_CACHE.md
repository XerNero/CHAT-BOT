# Pertanyaan: Apa Itu BM25 Cache dan Fungsinya?

## Pertanyaan Dosen
> "BM25 Cache itu apa? Fungsinya untuk apa?"

---

## ğŸ¯ Jawaban Singkat (1 Menit)

**"Pak, BM25 Cache adalah penyimpanan di RAM untuk mempercepat keyword search:**
1. **Apa yang disimpan:** Semua chunks + statistik kata (Document Frequency)
2. **Kenapa perlu:** Supaya tidak query database setiap kali user bertanya
3. **Hasilnya:** BM25 search ~5ms (tanpa cache ~70ms)"

---

## ğŸ“– Penjelasan Detail

### Apa Itu BM25 Cache?

**BM25 Cache = Penyimpanan sementara di RAM** yang berisi:
1. Semua chunks dari database
2. Statistik kata untuk perhitungan BM25

```javascript
let keywordCache = {
  points: [],      // Semua chunks (id + text)
  df: new Map(),   // Document Frequency setiap kata
  avgdl: 0,        // Rata-rata panjang dokumen
};
```

---

### Yang Disimpan di Cache

#### 1. `points` - Semua Chunks
```javascript
points: [
  { id: 1, payload: { text: "Syarat yudisium adalah lulus semua MK..." } },
  { id: 2, payload: { text: "IPK minimal untuk yudisium adalah 2.00..." } },
  { id: 3, payload: { text: "Mahasiswa harus sudah sidang skripsi..." } },
  // ... 60 chunks
]
```

#### 2. `df` - Document Frequency
**Berapa dokumen yang mengandung kata tertentu?**

```javascript
df: Map {
  "syarat" => 15,      // Kata "syarat" muncul di 15 chunks
  "yudisium" => 8,     // Kata "yudisium" muncul di 8 chunks
  "IPK" => 5,          // Kata "IPK" muncul di 5 chunks
  "mahasiswa" => 45,   // Kata "mahasiswa" muncul di 45 chunks
  "__N__" => 60,       // Total jumlah chunks
}
```

**Gunanya:** Kata langka (IPK) lebih penting dari kata umum (mahasiswa) â†’ IDF di BM25

#### 3. `avgdl` - Average Document Length
```javascript
avgdl: 150  // Rata-rata setiap chunk punya 150 token
```

**Gunanya:** Normalisasi panjang dokumen di formula BM25

---

## ğŸ“Š Diagram: Kapan Cache Di-Build?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                KAPAN BM25 CACHE DI-BUILD?                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  1. SAAT SERVER START:                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  node server.mjs                                         â”‚   â”‚
â”‚  â”‚       â”‚                                                  â”‚   â”‚
â”‚  â”‚       â–¼                                                  â”‚   â”‚
â”‚  â”‚  rebuildKeywordCache()                                   â”‚   â”‚
â”‚  â”‚       â”‚                                                  â”‚   â”‚
â”‚  â”‚       â–¼                                                  â”‚   â”‚
â”‚  â”‚  Server ready! Cache siap dipakai                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  2. SETELAH UPLOAD PDF:                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  POST /ingest (upload peraturan_baru.pdf)                â”‚   â”‚
â”‚  â”‚       â”‚                                                  â”‚   â”‚
â”‚  â”‚       â–¼                                                  â”‚   â”‚
â”‚  â”‚  Chunks baru disimpan ke Qdrant                          â”‚   â”‚
â”‚  â”‚       â”‚                                                  â”‚   â”‚
â”‚  â”‚       â–¼                                                  â”‚   â”‚
â”‚  â”‚  rebuildKeywordCache() â† Refresh cache!                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Diagram: Proses Build Cache

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   PROSES BUILD BM25 CACHE                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  STEP 1: Load dari Qdrant                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚
â”‚  â”‚     QDRANT     â”‚                                             â”‚
â”‚  â”‚   (Database)   â”‚                                             â”‚
â”‚  â”‚                â”‚     qdrant.scroll()                         â”‚
â”‚  â”‚  [Chunk 1]     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                     â”‚
â”‚  â”‚  [Chunk 2]     â”‚                       â”‚                     â”‚
â”‚  â”‚  [...]         â”‚                       â”‚                     â”‚
â”‚  â”‚  [Chunk 60]    â”‚                       â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚                     â”‚
â”‚                                           â–¼                     â”‚
â”‚  STEP 2: Hitung Statistik                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Untuk setiap chunk:                                     â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  "Syarat yudisium adalah lulus semua MK"                â”‚   â”‚
â”‚  â”‚       â”‚                                                  â”‚   â”‚
â”‚  â”‚       â–¼                                                  â”‚   â”‚
â”‚  â”‚  Tokenize: ["syarat", "yudisium", "lulus", "semua", "mk"]â”‚   â”‚
â”‚  â”‚       â”‚                                                  â”‚   â”‚
â”‚  â”‚       â–¼                                                  â”‚   â”‚
â”‚  â”‚  Update DF:                                              â”‚   â”‚
â”‚  â”‚    df["syarat"] += 1                                    â”‚   â”‚
â”‚  â”‚    df["yudisium"] += 1                                  â”‚   â”‚
â”‚  â”‚    ...                                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                           â”‚                     â”‚
â”‚                                           â–¼                     â”‚
â”‚  STEP 3: Simpan ke RAM                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   BM25 CACHE (RAM)                       â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  points: [chunk1, chunk2, ... chunk60]                  â”‚   â”‚
â”‚  â”‚  df: {"syarat":15, "yudisium":8, "IPK":5, ...}         â”‚   â”‚
â”‚  â”‚  avgdl: 150                                              â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  âœ… CACHE SIAP DIPAKAI!                                         â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Diagram: Penggunaan Cache Saat Query

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               PENGGUNAAN CACHE SAAT QUERY                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  User: "Apa syarat yudisium?"                                   â”‚
â”‚             â”‚                                                    â”‚
â”‚             â–¼                                                    â”‚
â”‚  Tokenize: ["apa", "syarat", "yudisium"]                        â”‚
â”‚             â”‚                                                    â”‚
â”‚             â”‚  LANGSUNG dari RAM (tidak query Qdrant!)          â”‚
â”‚             â–¼                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    BM25 CACHE                            â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Untuk SETIAP chunk:                                     â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Chunk 1: "Syarat yudisium adalah lulus..."             â”‚   â”‚
â”‚  â”‚           â”‚                                              â”‚   â”‚
â”‚  â”‚           â–¼                                              â”‚   â”‚
â”‚  â”‚  Hitung BM25:                                            â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚  TF("syarat") = 2 (muncul 2x di chunk)          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  IDF("syarat") = log(60/15) = 1.39              â”‚    â”‚   â”‚
â”‚  â”‚  â”‚           dari cache: __N__=60, df["syarat"]=15 â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                                                  â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  score = TF Ã— IDF Ã— norm(avgdl) = 2.64          â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Chunk 2: score = 1.85                                  â”‚   â”‚
â”‚  â”‚  Chunk 3: score = 0 (tidak match)                       â”‚   â”‚
â”‚  â”‚  ...                                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚             â”‚                                                    â”‚
â”‚             â–¼                                                    â”‚
â”‚  Sort â†’ Return top results â†’ Gabung dengan Vector via RRF      â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš¡ Perbandingan: Dengan vs Tanpa Cache

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              TANPA CACHE vs DENGAN CACHE                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  TANPA CACHE:                                                   â”‚
â”‚  Query â†’ Qdrant (load chunks) â†’ Hitung DF â†’ Hitung BM25        â”‚
â”‚              â†‘                      â†‘                            â”‚
â”‚         ~50ms I/O              ~20ms CPU                         â”‚
â”‚                                                                  â”‚
â”‚  Total: ~70ms per query                                         â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  DENGAN CACHE:                                                  â”‚
â”‚  Query â†’ RAM (chunks + DF sudah siap) â†’ Hitung BM25             â”‚
â”‚              â†‘                              â†‘                    â”‚
â”‚         ~0ms (RAM)                      ~5ms CPU                 â”‚
â”‚                                                                  â”‚
â”‚  Total: ~5ms per query  â† 14x LEBIH CEPAT! ğŸš€                   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Referensi Kode

**ğŸ“ File:** `apps/api/server.mjs`

| Komponen | Baris | Fungsi |
|----------|-------|--------|
| `keywordCache` variable | 191-195 | Struktur cache |
| `rebuildKeywordCache()` | 197-243 | Build/refresh cache |
| `bm25Score()` | 250-270 | Hitung skor BM25 |
| Penggunaan di query | 450-467 | Loop setiap chunk di cache |

---

## ğŸ—£ï¸ Cara Menjelaskan ke Dosen

**"Pak, BM25 Cache itu:**

1. **"Apa itu?"**
   - Penyimpanan di RAM untuk keyword search
   - Berisi chunks + statistik kata

2. **"Yang disimpan:"**
   - `points`: semua chunks
   - `df`: Document Frequency (kata X ada di berapa dokumen)
   - `avgdl`: rata-rata panjang dokumen

3. **"Kapan di-build:"**
   - Saat server start
   - Setelah upload PDF baru

4. **"Kenapa perlu cache:"**
   - Tanpa cache: query Qdrant setiap kali â†’ lambat (70ms)
   - Dengan cache: langsung dari RAM â†’ cepat (5ms)
   - **14x lebih cepat!**

---

## âœ… Checklist Pemahaman

- [ ] Bisa jelaskan apa itu BM25 Cache
- [ ] Bisa jelaskan apa yang disimpan (points, df, avgdl)
- [ ] Bisa jelaskan kapan cache di-build
- [ ] Bisa jelaskan kenapa cache membuat search lebih cepat
- [ ] Bisa tunjukkan kode (baris 191-243, 250-270)
